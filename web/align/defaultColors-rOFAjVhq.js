import{g as L,a as T,b as E,s as M}from"./groups-xoLWjEXo.js";import{c as V}from"./main.js";const $={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},_=new Map,O=e=>{const r=_.get(e);return r?Object.fromEntries(Object.entries(r.stores).map(([o,t])=>[o,t.getState()])):{}},j=(e,r,o)=>{if(e===void 0)return{type:"untracked",connection:r.connect(o)};const t=_.get(o.name);if(t)return{type:"tracked",store:e,...t};const s={connection:r.connect(o),stores:{}};return _.set(o.name,s),{type:"tracked",store:e,...s}},W=(e,r)=>{if(r===void 0)return;const o=_.get(e);o&&(delete o.stores[r],Object.keys(o.stores).length===0&&_.delete(e))},G=e=>{var r,o;if(!e)return;const t=e.split(`
`),s=t.findIndex(n=>n.includes("api.setState"));if(s<0)return;const a=((r=t[s+1])==null?void 0:r.trim())||"";return(o=/.+ (.+) .+/.exec(a))==null?void 0:o[1]},J=(e,r={})=>(o,t,s)=>{const{enabled:a,anonymousActionType:n,store:c,...i}=r;let l;try{l=(a??($?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!l)return e(o,t,s);const{connection:u,...g}=j(c,l,i);let m=!0;s.setState=((p,d,f)=>{const b=o(p,d);if(!m)return b;const N=f===void 0?{type:n||G(new Error().stack)||"anonymous"}:typeof f=="string"?{type:f}:f;return c===void 0?(u?.send(N,t()),b):(u?.send({...N,type:`${c}/${N.type}`},{...O(i.name),[c]:s.getState()}),b)}),s.devtools={cleanup:()=>{u&&typeof u.unsubscribe=="function"&&u.unsubscribe(),W(i.name,c)}};const y=(...p)=>{const d=m;m=!1,o(...p),m=d},F=e(s.setState,t,s);if(g.type==="untracked"?u?.init(F):(g.stores[g.store]=s,u?.init(Object.fromEntries(Object.entries(g.stores).map(([p,d])=>[p,p===g.store?F:d.getState()])))),s.dispatchFromDevtools&&typeof s.dispatch=="function"){let p=!1;const d=s.dispatch;s.dispatch=(...f)=>{($?"production":void 0)!=="production"&&f[0].type==="__setState"&&!p&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),p=!0),d(...f)}}return u.subscribe(p=>{var d;switch(p.type){case"ACTION":if(typeof p.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return U(p.payload,f=>{if(f.type==="__setState"){if(c===void 0){y(f.state);return}Object.keys(f.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const b=f.state[c];if(b==null)return;JSON.stringify(s.getState())!==JSON.stringify(b)&&y(b);return}s.dispatchFromDevtools&&typeof s.dispatch=="function"&&s.dispatch(f)});case"DISPATCH":switch(p.payload.type){case"RESET":return y(F),c===void 0?u?.init(s.getState()):u?.init(O(i.name));case"COMMIT":if(c===void 0){u?.init(s.getState());return}return u?.init(O(i.name));case"ROLLBACK":return U(p.state,f=>{if(c===void 0){y(f),u?.init(s.getState());return}y(f[c]),u?.init(O(i.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return U(p.state,f=>{if(c===void 0){y(f);return}JSON.stringify(s.getState())!==JSON.stringify(f[c])&&y(f[c])});case"IMPORT_STATE":{const{nextLiftedState:f}=p.payload,b=(d=f.computedStates.slice(-1)[0])==null?void 0:d.state;if(!b)return;y(c===void 0?b:b[c]),u?.send(null,f);return}case"PAUSE_RECORDING":return m=!m}return}}),F},K=J,U=(e,r)=>{let o;try{o=JSON.parse(e)}catch(t){console.error("[zustand devtools middleware] Could not parse the received json",t)}o!==void 0&&r(o)},I=(e,r,o)=>{const t=r/100,s=o/100,a=s*t,n=a*(1-Math.abs(e/60%2-1)),c=s-a;let i=0,l=0,u=0;return 0<=e&&e<60?(i=a,l=n,u=0):60<=e&&e<120?(i=n,l=a,u=0):120<=e&&e<180?(i=0,l=a,u=n):180<=e&&e<240?(i=0,l=n,u=a):240<=e&&e<300?(i=n,l=0,u=a):300<=e&&e<360&&(i=a,l=0,u=n),{r:Math.round((i+c)*255),g:Math.round((l+c)*255),b:Math.round((u+c)*255)}},B=(e,r,o)=>{const t=e/255,s=r/255,a=o/255,n=Math.max(t,s,a),c=Math.min(t,s,a),i=n-c;let l=0,u=0,g=n;if(i!==0){switch(u=i/n,n){case t:l=(s-a)/i%6;break;case s:l=(a-t)/i+2;break;case a:l=(t-s)/i+4;break}l*=60,l<0&&(l+=360)}return{h:l,s:u*100,v:g*100}},X=(e,r,o)=>{const t=s=>{const a=Math.round(Math.max(0,Math.min(255,s))).toString(16);return a.length===1?"0"+a:a};return`#${t(e)}${t(r)}${t(o)}`.toUpperCase()},Y=e=>{const r=e.replace("#","");if(r.length!==6)throw new Error("Invalid hex color format");const o=parseInt(r.slice(0,2),16),t=parseInt(r.slice(2,4),16),s=parseInt(r.slice(4,6),16);return{r:o,g:t,b:s}},C=(e,r,o)=>{const t=I(e,r,o);return X(t.r,t.g,t.b)},z=e=>{const r=Y(e);return B(r.r,r.g,r.b)},se=e=>/^#?([A-Fa-f0-9]{3}|[A-Fa-f0-9]{6}|[A-Fa-f0-9]{8})$/.test(e);function k(e){try{let r=(e||"").trim().toUpperCase();r.startsWith("#")||(r=`#${r}`);const o=r.length===9?r.slice(0,7):r,{h:t,s,v:a}=z(o),n=Math.max(0,Math.min(100,a-12));return C(t,s,n)}catch{let r=(e||"#FFFFFF").trim().toUpperCase();return r.startsWith("#")||(r=`#${r}`),r.length===9?r.slice(0,7):r}}const D=!0,Z={applyHeaderOnly:"comfyuiAlign.applyColorHeaderOnly"};function q(e,r){if(typeof e=="boolean")return e;if(typeof e=="string"){if(e.toLowerCase()==="true")return!0;if(e.toLowerCase()==="false")return!1}return r}function R(){try{const r=window?.app?.extensionManager?.setting?.get?.(Z.applyHeaderOnly);return q(r,D)}catch{return D}}function S(e,r){if(!e||typeof e!="string")return"#FFFFFFFF";let o=e.trim().toUpperCase();return o.startsWith("#")||(o=`#${o}`),o.length===9?o.slice(0,7)+r.toUpperCase():o.length===7?o+r.toUpperCase():"#FFFFFFFF"}function H(e){const r=Math.max(0,Math.min(1,e)),t=Math.round(r*255).toString(16).toUpperCase();return t.length===1?"0"+t:t}function ne(e){const r=L(),o=T(r),t=E(r);if(!o.length&&!t.length)return;const s=R();o.forEach(a=>{if(s)a.color=S(e,"FF");else{a.bgcolor=S(e,"FF");try{const n=k(e);a.color=S(n,"FF")}catch{a.color=S(e,"FF")}}}),t.forEach(a=>{try{a.color=S(e,"FF")}catch{}}),M(r)}function P(e,r){const o=L(),t=T(o),s=E(o);if(!t.length&&!s.length)return;const a=R(),n=H(r);t.forEach(c=>{if(a)c.color=S(e,n);else{c.bgcolor=S(e,n);try{const i=k(e);c.color=S(i,n)}catch{c.color=S(e,n)}}}),s.forEach(c=>{try{c.color=S(e,n)}catch{}}),M(o)}function Q(e){const r=L(),o=T(r),t=E(r);if(!o.length&&!t.length)return;const s=R(),a=H(e),n=i=>{if(typeof i!="string")return!1;const l=i.trim();return/^#?[0-9A-Fa-f]{6}([0-9A-Fa-f]{2})?$/.test(l)},c=i=>{let l=i.trim().toUpperCase();return l.startsWith("#")||(l=`#${l}`),l};o.forEach(i=>{try{if(s){if(n(i.color)){const l=c(i.color);i.color=S(l,a)}}else{if(n(i.bgcolor)){const l=c(i.bgcolor);i.bgcolor=S(l,a)}if(n(i.color)){const l=c(i.color);i.color=S(l,a)}}}catch{}}),t.forEach(i=>{try{if(n(i.color)){const l=c(i.color);i.color=S(l,a)}}catch{}}),M(r)}function ae(){const e=L(),r=T(e),o=E(e);!r.length&&!o.length||(r.forEach(t=>{try{delete t.color,delete t.bgcolor}catch{}}),o.forEach(t=>{try{delete t.color}catch{}}),M(e))}function w(e){try{let r=(e||"").trim().toUpperCase();if(r.startsWith("#")||(r=`#${r}`),r.length===9)return r;if(r.length===7)return r+H(1);const o=r.replace(/[^A-F0-9]/g,"");return o.length>=6?`#${o.slice(0,6)}`+H(1):`#FFFFFF${H(1)}`}catch{return`#FFFFFF${H(1)}`}}const x={hue:0,saturation:100,value:100,alpha:1},h=V()(K((e,r)=>({hue:x.hue,saturation:x.saturation,value:x.value,alpha:x.alpha,history:[],presets:[],presetLabels:{},presetLabelList:{},presetSource:{},isPickerActive:!1,getRGB:()=>{const{hue:o,saturation:t,value:s}=r();return I(o,t,s)},getHex:()=>{const{hue:o,saturation:t,value:s}=r();return C(o,t,s)},getHex8:()=>{const{hue:o,saturation:t,value:s,alpha:a}=r();return C(o,t,s)+H(a)},getHSV:()=>{const{hue:o,saturation:t,value:s}=r();return{h:o,s:t,v:s}},setHue:o=>{e({hue:Math.max(0,Math.min(360,o))},!1,"setHue");const{hue:t,saturation:s,value:a,alpha:n}=r();P(C(t,s,a),n)},setSaturation:o=>{e({saturation:Math.max(0,Math.min(100,o))},!1,"setSaturation");const{hue:t,saturation:s,value:a,alpha:n}=r();P(C(t,s,a),n)},setValue:o=>{e({value:Math.max(0,Math.min(100,o))},!1,"setValue");const{hue:t,saturation:s,value:a,alpha:n}=r();P(C(t,s,a),n)},setAlpha:o=>{e({alpha:Math.max(0,Math.min(1,o))},!1,"setAlpha");const{alpha:t}=r();Q(t)},setHSV:(o,t,s)=>{e({hue:Math.max(0,Math.min(360,o)),saturation:Math.max(0,Math.min(100,t)),value:Math.max(0,Math.min(100,s))},!1,"setHSV");const{hue:a,saturation:n,value:c,alpha:i}=r();P(C(a,n,c),i)},setFromRGB:(o,t,s)=>{const a=B(o,t,s);e({hue:a.h,saturation:a.s,value:a.v},!1,"setFromRGB");const{hue:n,saturation:c,value:i,alpha:l}=r();P(C(n,c,i),l)},setFromHex:o=>{try{let t=o.trim().toUpperCase();t.startsWith("#")||(t=`#${t}`);let s=null,a=t;t.length===9&&(s=Math.max(0,Math.min(1,parseInt(t.slice(7,9),16)/255)),a=t.slice(0,7));const n=z(a),c={hue:n.h,saturation:n.s,value:n.v};s!==null&&(c.alpha=s),e(c,!1,"setFromHex");const{hue:i,saturation:l,value:u,alpha:g}=r();P(C(i,l,u),g)}catch(t){console.warn("Invalid hex color:",o,t)}},addToHistory:o=>{const t=r(),s=H(t.alpha);let n=(o||t.getHex()).trim().toUpperCase();n.startsWith("#")||(n=`#${n}`),n.length===9||(n.length===7?n=n+s:n=t.getHex()+s),e(c=>({history:[n,...c.history.filter(i=>i!==n).slice(0,9)]}),!1,"addToHistory")},clearHistory:()=>{e({history:[]},!1,"clearHistory")},addPreset:o=>{const t=o||r().getHex();e(s=>({presets:s.presets.includes(t)?s.presets:[...s.presets,t]}),!1,"addPreset")},removePreset:o=>{e(t=>{const s=t.presets[o],a=t.presets.filter((l,u)=>u!==o),n={...t.presetLabels||{}},c={...t.presetLabelList||{}},i={...t.presetSource||{}};if(s){const l=w(s),g=t.presets.map((y,F)=>w(y)===l?F:-1).filter(y=>y>=0).indexOf(o),m=Array.isArray(c[l])?[...c[l]]:[];g>=0&&g<m.length?m.splice(g,1):m.length&&m.pop(),m.length===0?(delete c[l],n[l]&&delete n[l],i[l]&&delete i[l]):(c[l]=m,n[l]=m[0])}return{presets:a,presetLabels:n,presetLabelList:c,presetSource:i}},!1,"removePreset")},clearPresets:()=>{e({presets:[],presetLabels:{},presetLabelList:{},presetSource:{}},!1,"clearPresets")},setPresetsFromConfig:o=>{try{const t=[],s={},a={},n={};for(const c of o||[]){const i=c.title||"Unknown";let l;c.bgcolor?(l=w(c.bgcolor),n[l]="panel"):c.color&&(l=w(c.color),n[l]="header"),l&&(t.push(l),s[l]=`${i}`,a[l]=a[l]||[],a[l].push(`${i}`))}e({presets:t,presetLabels:s,presetLabelList:a,presetSource:n},!1,"setPresetsFromConfig")}catch(t){console.warn("setPresetsFromConfig failed",t)}},removePresetByColor:o=>{const t=w(o);e(s=>{const a=s.presets.filter(l=>w(l)!==t),n={...s.presetLabels||{}};n[t]&&delete n[t];const c={...s.presetLabelList||{}};c[t]&&delete c[t];const i={...s.presetSource||{}};return i[t]&&delete i[t],{presets:a,presetLabels:n,presetLabelList:c,presetSource:i}},!1,"removePresetByColor")},setPickerActive:o=>{e({isPickerActive:o},!1,"setPickerActive")},reset:()=>{e({hue:x.hue,saturation:x.saturation,value:x.value,alpha:x.alpha,history:[],presets:[],presetLabels:{},isPickerActive:!1},!1,"reset")}}),{name:"color-store",enabled:!1})),ce=()=>{const e=h();return{hue:e.hue,saturation:e.saturation,value:e.value,alpha:e.alpha,rgb:e.getRGB(),hex:e.getHex(),hsv:e.getHSV(),setHue:e.setHue,setSaturation:e.setSaturation,setValue:e.setValue,setAlpha:e.setAlpha,setHSV:e.setHSV,setFromRGB:e.setFromRGB,setFromHex:e.setFromHex,updateColor:(r,o,t)=>{e.setHSV(r,o,t),e.addToHistory()}}},ie=()=>{const e=h(t=>t.history),r=h(t=>t.addToHistory),o=h(t=>t.clearHistory);return{history:e,addToHistory:r,clearHistory:o}},le=()=>{const e=h(i=>i.presets),r=h(i=>i.presetLabels),o=h(i=>i.presetLabelList),t=h(i=>i.presetSource),s=h(i=>i.addPreset),a=h(i=>i.removePreset),n=h(i=>i.removePresetByColor),c=h(i=>i.clearPresets);return{presets:e,presetLabels:r,presetLabelList:o,presetSource:t,addPreset:s,removePreset:a,removePresetByColor:n,clearPresets:c}},ue=()=>{const e=h(s=>s.isPickerActive),r=h(s=>s.setPickerActive),o=h(s=>s.setFromRGB),t=h(s=>s.addToHistory);return{isPickerActive:e,setPickerActive:r,pickColor:(s,a,n)=>{o(s,a,n),t()}}};function v(e){try{return String(e||"").replace(/\([^)]*\)/g,"").replace(/[^A-Za-z0-9]/g,"")}catch{return String(e||"")}}function A(e){try{const r=(e??"").trim();if(!r)return null;let o=r.startsWith("#")?r.slice(1):r;if(o=o.replace(/[^A-Fa-f0-9]/g,""),o.length===3){const t=o[0],s=o[1],a=o[2];return`#${(t+t+s+s+a+a).toUpperCase()}FF`}if(o.length===4){const t=o[0],s=o[1],a=o[2],n=o[3];return`#${(t+t+s+s+a+a+n+n).toUpperCase()}`}return o.length===6?`#${o.toUpperCase()}FF`:o.length===8?`#${o.toUpperCase()}`:null}catch{return null}}async function pe(){try{const e=await fetch("/align/api/color_presets");if(!e.ok)return;const r=await e.json();let o=Array.isArray(r?.nodes)?r.nodes:[];o=o.filter(a=>v(a.type)!==v("MarkdownNote"));const t=o.map(a=>({title:String(a.type||"Unknown"),color:a.color||void 0,bgcolor:a.bgcolor||void 0}));h.getState().setPresetsFromConfig?.(t)}catch{}}async function fe(){try{h.getState().clearPresets(),await fetch("/align/api/color_presets/all",{method:"DELETE"})}catch{}}async function ee(){try{const e=L(),r=T(e),o=[];for(const t of r||[]){const s=String(t?.type||""),a=String(t?.title||t?.properties?.["Node name for S&R"]||s||"Unknown");if(v(s)===v("MarkdownNote")||v(a)===v("MarkdownNote"))continue;const n=A(t?.color),c=A(t?.bgcolor);(n||c)&&o.push({type:a,color:n,bgcolor:c})}return o}catch{return[]}}async function te(){try{const r=L()?.graph?._nodes||[],o=[];for(const t of r||[]){const s=String(t?.type||""),a=String(t?.title||t?.properties?.["Node name for S&R"]||s||"Unknown");if(v(s)===v("MarkdownNote")||v(a)===v("MarkdownNote"))continue;const n=A(t?.color),c=A(t?.bgcolor);(n||c)&&o.push({type:a,color:n,bgcolor:c})}return o}catch{return[]}}async function de(){try{let e=await ee();if(e.length||(e=await te()),e=e.filter(n=>v(n.type)!==v("MarkdownNote")),!e.length)return!1;const r=await fetch("/align/api/color_presets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nodes:e})});if(!r.ok)return!1;const o=await r.json(),s=(Array.isArray(o?.config?.nodes)?o.config.nodes:e).map(n=>({title:String(n.type||"Unknown"),color:n.color||void 0,bgcolor:n.bgcolor||void 0}));return h.getState().setPresetsFromConfig?.(s),!0}catch{return!1}}async function he(){try{const e=L();let r=T(e);(r?.length||0)>0||(r=e?.graph?._nodes||[]);const t=R(),s=await fetch("/align/api/color_presets");if(!s.ok)return;const a=await s.json(),n=Array.isArray(a?.nodes)?a.nodes:[];for(const c of r){const i=String(c?.type||"");if(v(i)===v("MarkdownNote"))continue;const l=String(c?.type||""),u=String(c?.properties?.["Node name for S&R"]||""),g=String(c?.title||""),m=v(g),y=n.find(d=>d.type===g)||(u?n.find(d=>d.type===u):void 0)||n.find(d=>v(d.type)===m)||n.find(d=>d.type===l);if(!y)continue;const F=A(y.color),p=A(y.bgcolor);if(t){if(F)c.color=F;else if(p)try{const d=k(p);c.color=A(d)}catch{c.color=p}}else if(p){c.bgcolor=p;try{const d=k(p);c.color=A(d)}catch{c.color=p}}else F&&(c.color=F)}M(e)}catch{}}const ye=["#922B2B","#924C2B","#92782B","#2E772E","#2C7875","#2B628A","#5A4283"];export{ye as D,ce as a,he as b,ae as c,ne as d,ue as e,le as f,fe as g,I as h,se as i,h as j,pe as l,de as s,ie as u};
